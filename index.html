  <html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
  <script src="cursorMovements.js"></script>
  <script src="recursive.js"></script>
  <link rel= 'stylesheet' href='styles.css'>
  
  <script>
    //other classes
    const CursorMovements = new CursorMovementsClass()
    const Recursive = new RecursiveClass() 
    //constant height value
    let FIRSTSETHEIGHT = 200
    let DASH = '-'
    let areDashes = true;
    </script>
    
    <canvas
      id="canvas_id"
      width="220px"
      height=FIRSTSETHEIGHT
      style="border: 1px solid #550233"
    > </canvas>
    <div id="xAndY" style = "font-size:.55rem; margin-left:3rem;"></div>
    <div style = "margin:0rem; padding:0rem;" id = "stylingHere">
      
    <div style = "display:flex; margin-left:1.15rem; margin-bottom: 0rem; padding-bottom:0rem" >
      <button id = "insert" style = "padding-top:0rem; margin-top:.25rem; width:2rem; font-size: .4rem; margin-left:20px; " >Insert</button>
      
      <button id = "areDashes" style = "margin-top:.25rem;  margin-left:.7rem;  font-size: .4rem; " >Show Without Dashes</button>
      
    </div>
    
  </div>
  <script>
   let horizontalCursorPosition = 0
  let verticalCursorPosition = 0
  let MAXROWS = 15
  
  // The grid, last row is a padding for recursion. 
  
  let gridArray = [
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, "a", DASH, DASH, DASH, DASH , "z", DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    ["a", "A", DASH, DASH, DASH, DASH , DASH, DASH, "b", DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, "4" , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, "5" , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
     
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, "Y" ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH],
    ["S", DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
     
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, "6" , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, "B" ],
    ["A", "B", "C", DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
         
    ["U", DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, "7" , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    ["T", DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, "a", "b", DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, "1" ],
         //["!", "!", "!", "!", "!", "!" , "!", "!", "!", "!", "!", "!", "!" , "!", "!", "!", "!", "!", "!", "!" , "!", "!","!", "!", "!", "!", "!" , "!" ],
    
  ];

  let copyArray = []
  /*
    let gridArray = [
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
     
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
     
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
         
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
    [DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH, DASH, DASH, DASH, DASH, DASH, DASH , DASH,DASH, DASH, DASH, DASH, DASH, DASH, DASH ],
         //["!", "!", "!", "!", "!", "!" , "!", "!", "!", "!", "!", "!", "!" , "!", "!", "!", "!", "!", "!", "!" , "!", "!","!", "!", "!", "!", "!" , "!" ],
    
  ];
  

  */
  
  //canvas
  let WIDTH = 28
  let HEIGHT = 15
  let ORIGINALHEIGHT = 15
  const VOFFSET = 32
  const HOFFSET = 35
  var canvas = document.getElementById('canvas_id')
  var insertOn = document.getElementById('insert')
  let textBox = [[]]
  let rows = WIDTH
  let cols = HEIGHT
  let ctx = canvas.getContext('2d')
  var size = 220
  canvas.style.width = size + 'px'
  canvas.style.height = size + 'px'
  var scale = window.devicePixelRatio 
  canvas.width = size * scale
  canvas.height = size * scale
  ctx.scale(scale, scale)
  ctx.fillStyle = '#ffffff'
  ctx.fillRect(0, 0, 800, 800)
  ctx.fillStyle = '#000000'
  ctx.font = '10px Monospace'
  var x = size / 2
  var y = size / 2
  var insertOn = true
  
  //clears out grid
  function clearArray() {
    ctx.clearRect(0, 0, 100, 100)
    ctx.fillStyle = '#ffffff'
    ctx.fillRect(0, 0, canvas.width, canvas.height)
    ctx.fillStyle = '#000000'
  }
  
  function makeCanvas(verticalSize = FIRSTSETHEIGHT){
  var size = verticalSize
  let hsize = 200
  canvas.style.width = hsize + 'px'
  canvas.style.height = size + 'px'
  var scale = window.devicePixelRatio 
  canvas.width = hsize * scale
  canvas.height = size * scale
  ctx.scale(scale, scale)
  ctx.fillStyle = '#ffffff'
  ctx.fillRect(0, 0, 800, 800)
  ctx.font = '10px Monospace'
  ctx.textAlign = 'center'
 
  }
  
  //draws grid
  function drawGrid(iValue = HEIGHT, jValue = WIDTH) {
    let extraHeightRows = HEIGHT - ORIGINALHEIGHT
    let totalVert = extraHeightRows*10 + 200
    makeCanvas(totalVert)
    clearArray()
    ctx.fillStyle = 'red'
    ctx.fillText("Javascript Text Editor", 96 , 18)
    ctx.fillStyle = 'black'
    for (let i = 0; i < iValue; i++) {
    for (let j = 0; j < jValue ; j++) {
    console.log("na: ", gridArray)
    if(gridArray && gridArray[i] && gridArray[i][j]){
    ctx.fillText(gridArray[i][j], j * 5 + 30 , i * 10 + 33)
    console.log("ZZZ: ", {j}, {i})
    }else{
      continue
    }
    }
  }
}

  //draws cursor on grid
  function drawCursor(x,y){
    //28 tiles times 5 is 140
    if(x === HOFFSET + 140){
      if(x == HOFFSET + (WIDTH * 5))
      x = 0 + HOFFSET;
      y =y + 10
    }
    ctx.font = '10px Monospace'
    ctx.fillStyle = 'red'
    console.log("y: ", y)
    ctx.fillText('_', x - 5, y)
    }

    function changeInsert(){
      alert("here")
    }

    let gKey = ''
    var keyState = {}
    let eventKeyCode = ""
    let down = false
    let inserting = document.getElementById('insert')
    let dashing = document.getElementById('areDashes')
    
     inserting.addEventListener("click", function(){
      if (insertOn === true){
      insertOn = false}
      else{
      insertOn = true
      }
        if(insertOn == true){
          document.getElementById("insert").innerHTML = "Insert"
        }else{
          document.getElementById("insert").innerHTML = "On Top"
        }
    })

    //function changeDashes(){
    dashing.addEventListener("click", function(){
      if(areDashes){
        DASH = " "
      }else{
        DASH = "-"
      }

     
      //change dashes to spaces
      if(areDashes){
      copyArray = gridArray.map(arr => [...arr])
      for(let i = 0; i<HEIGHT; i++){
        for(let j = 0; j < WIDTH ; j++){
         if ( gridArray[i][j] === "-"){
          gridArray[i][j] = " " 
         }
        }
        areDashes = !areDashes
        //grid is built with spaces, need to retein asoriginal spaces
      }
    }
    else{
        gridArray = copyArray.map(arr => [...arr])
        areDashes = !areDashes

    }
     


      
     //change spaces to dashes - can't edit matrix until changed back to dashes (above).
     if(areDashes == true){
          document.getElementById("areDashes").innerHTML = "Show Without Dashes"
        }else{
          document.getElementById("areDashes").innerHTML = "Continue Coding"
        }

      drawGrid(HEIGHT, WIDTH)
       
      //the dashes are spaces
      if(!areDashes){
    
      }else{
        Recursive.displayGridAndCursor()
      }
      
    })
   
    document.body.addEventListener('keydown', function(e){
   
    keyState[e.keyCode || e.which] = true;
    eventKeyCode = e.keyCode
    gKey = e.key
    if (down) return
    down = true
    cursorAndFunctionCalls()
    displayCursorLocations()
    }, false)

    document.addEventListener('keyup', function(e){
    keyState[e.keyCode || e.which] = false;
    gKey = e.key
    eventKeyCode = e.keyCode
    down = false
    }, false)
     
   // removed from list : 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Delete'
    const preventKeys = [
    'Tab', 'Enter', 'Backspace', 'PageUp', 'PageDown', 'Home', 'End','Control', 'Alt', 'Meta', 'Shift'
    ];
    
    function displayCursorLocations(){
      let a = document.getElementById("xAndY")
      a.innerHTML = 'Horizontal: ' + horizontalCursorPosition/5 + '&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp' + 'Vertical: '+ verticalCursorPosition/10

    }
    function cursorAndFunctionCalls() {
    displayCursorLocations()
    for (let i = 0; i < preventKeys.length;i++){
      if( preventKeys[i] == gKey){
        return
      }
    }
    //right
    if(keyState[39]){
    //?
    Recursive.advanceHorizontalOneTime()
    CursorMovements.cursorRight() 
    }
    //left
    else if(keyState[37]){
      CursorMovements.cursorLeft()
    }
    //up
    else if(keyState[38]){
      CursorMovements.cursorUp()
    }
    //down
    else if(keyState[40]){
      CursorMovements.cursorDown()
    } 
    //these are the funcitons for keystorkes other than cursor movement keys
    else if (gKey === "-"){
      return
    }
    
    else if(gKey === 'Delete' )
    {
       //console.log("nested array3: ", gridArray);
       //gridArray = Recursive.deleteAndPullCharacters([], verticalCursorPosition/10, horizontalCursorPosition/5,  gridArray)
       gridArray = Recursive.deleteAndPullCharacters(1, verticalCursorPosition/10, horizontalCursorPosition/5,  gridArray)
    }
    else if(gKey === "Backspace"){

      //gridArray = Recursive.deleteCharacterWithoutPull(verticalCursorPosition/10, horizontalCursorPosition/5, gridArray, gKey)
      gridArray = Recursive.deleteAndPullCharacters(1, verticalCursorPosition/10, horizontalCursorPosition/5,  gridArray)
 
    }
    else if(gKey == "Enter"){
      gridArray = Recursive.pressedEnter(gridArray, verticalCursorPosition/10, horizontalCursorPosition/5, "",true, HEIGHT-1)
    }
    else if(gKey !== ""){
      //Recursive.lastCharacetrOnLineEndThereAlready = false
      if(gridArray[verticalCursorPosition/10][WIDTH-1] !=  "-"){
      //Recursive.LastCharacetrOnLineEndThereAlready = true
    }
    if(insertOn === true){
      gridArray = Recursive.initialInsertDoThisFirst(verticalCursorPosition/10, horizontalCursorPosition/5, gridArray, gKey)
      
      //drawGrid(HEIGHT, WIDTH)
      
      
    }else{
      //destructive text display here
      gridArray = Recursive.placeCharacterWithoutInsertDoThisFirst(verticalCursorPosition/10, horizontalCursorPosition/5, gridArray, gKey)
    }
    
    Recursive.CursorOnLastColumn = false
    Recursive.LastRowIndexToPushOn = -1
    }

    
    
    
    gridArray = Recursive.pushWordsDoThisSecond(gridArray, ["Z"], 0, true)
   
    
    drawGrid(HEIGHT, WIDTH)
     Recursive.displayGridAndCursor() 
        

    }
    
    //first run
     cursorAndFunctionCalls()
     drawGrid(HEIGHT, WIDTH)
     Recursive.displayGridAndCursor() 
    

     
    </script>
    </body>
